library(plotly)
#install.packages('plotly')
library(PlotSvalbard) # https://github.com/MikkoVihtakari/PlotSvalbard#installation
# clean dir to start
wd <- 'arcticPlotting'
dir.create(wd)
setwd(wd)
rm(wd)
datlist <- list.files( pattern = "\\.dat$", recursive = T )
fdata <- NULL
for(i in 1:length(datlist)) {
hdata <- read.delim2(datlist[i], header = F, sep = "", skip = 1, nrows = 1, stringsAsFactors= F )
# check if data rows contains integer, else no data and skip
if(is.integer(hdata$V5)) {
#initiate/reset temp data frame for current dat file
tdata <- NULL
# read dat to r table, take nr of rows indicated by header for observations hdata[,5]
txdata <- read.delim2(datlist[i], sep = "", header = T, na.strings ="", stringsAsFactors= F, skip = 2, nrows = hdata[,5], fill = T)
# add temps, depth, lat/lon(expand) to tdata as number
tdata$tempC <- as.numeric(txdata$temperature.C.)
tdata$depth <- -as.numeric(txdata$pressure.dbar.)
tdata$lat <- rep(as.numeric(hdata[,4]), length(tdata$tempC))
tdata$lon <- rep(as.numeric(hdata[,3]), length(tdata$tempC))
fdata <- merge(fdata,tdata, all = T)
}
if(i %in% seq(1,50000,10)) {
print(paste0("DatNr: ",i,"/",length(datlist)))
}
}
rm(hdata,tdata,txdata,datlist)
utm_coords <- transform_coord(lon = fdata$lon, lat = fdata$lat, new.names = c("lon.utm", "lat.utm"),
proj.og = "+proj=longlat +datum=WGS84",
proj.out = "+proj=stere +lat_0=90 +lat_ts=0 +lon_0=0 +k=1 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0",
map.type = 'panarctic',
verbose = FALSE,
bind = FALSE)
fdata$x <- utm_coords$lon.utm
fdata$y <- utm_coords$lat.utm
fdata$lon <- NULL
fdata$lat <- NULL
rm(utm_coords)
fdata2 <- fdata[(fdata$depth > -380),]
###
p <- plot_ly(fdata2, x = ~x, y = ~y, z = ~depth, color = ~tempC, name = ~tempC) %>%
add_markers() %>%
layout(title = "WHOI ITP 112 Buoy Temperatures",
scene = list(xaxis = list(title = 'Lon UTM (m)'),
yaxis = list(title = 'Lat UTM (m)'),
zaxis = list(title = 'Depth (m)')),
paper_bgcolor = '#f6fdff',
plot_bgcolor = '#f6fdff')
p
